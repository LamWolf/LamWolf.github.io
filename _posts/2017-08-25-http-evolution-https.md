---
layout: post
title: "http进化论"
subtitle: "https到底比http多了哪些东西"
tags:
    - http
    - https
    - 前端
date: 2017-08-25 12:00:00
author: "LamWolf"
catalog: true
header-img: "img/post-bg-http-to-https.jpg"
---


## 写在前面

隔了好久，终于算是有时间能打起精力再总结一些内容。这篇文章是在文章更新计划中搁置许久的一个“需求”，这之前关于https也只是了解一个大概，今天就好好地品一下“进化版的http”是怎样一个角色。

本文将着重总结HTTP与HTTPS协议的不同，简单总结HTTPS的基本原理，如果对HTTPS的原理有更浓厚的兴趣建议自行搜索学习。

## 目录

1. HTTP的特点及劣势
2. 什么是HTTPS
3. HTTPS是如何加密的？
4. HTTPS的缺陷

## 以下是正文

### 1.HTTP的特点及劣势

关于HTTP协议的基本原理请参照我之前总结的一篇文章[http的那些事儿](http://lamwolfwang.cn/2017/08/01/http-basic/)，在这里就不再赘述了，这次主要总结一下关于数据传输安全性方面的一些内容。

>HTTP是一个属于应用层的面向对象的协议，由于其简捷、快速的方式，适用于分布式超媒体信息系统。它于1990年提出，经过几年的使用与发展，得到不断地完善和扩展。

#### 1.1 HTTP协议传输简单快捷但“不负责任”

##### HTTP协议有以下几个特点：

1. 支持客户/服务器模式。
2. 简单快速：客户向服务器请求服务时，只需传送**请求方法**和**路径**。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。
3. 灵活：HTTP允许传输**任意类型**的数据对象。正在传输的类型由Content-Type加以标记。
4. 无连接：无连接的含义是限制**每次连接只处理一个请求**。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
5. 无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

HTTP为了能够应对大量的请求处理采取的态度是**只完成请求中要求完成的工作**，不考虑传来的请求是怎样的，不考虑完成请求后还有没有一些**善后工作**要完成，有需要那就再发请求过来。这种方式在一定程度上提高了传递效率，但牺牲的却是安全性。

#### 1.2 HTTP协议的缺点是明显且“致命”的

因为HTTP只“负责”完成请求中的要求，所以如果有人“干扰”服务器，那么服务器是无法鉴别的。

1. **通信使用明文(不加密)，内容可能被窃听(抓包工具可以获取请求和响应内容)。**

	HTTP 不会对请求和响应的内容进行加密，报文直接使用明文发送。报文在服务器与客户端流转中间，会经过若干个结点，这些结点中随时都可能会有窃听行为。因为通信一定会经过中间很多个结点，所以就算是报文经过了加密，也一样会被窃听到，不过是窃听到加密后的内容。要窃听相同段上的通信还是很简单的，比如可以使用常用的抓包工具 Wireshark。
	
2. **不验证通讯方的身份，可能遭遇伪装(任何人都能发送请求,不管对方是谁都会返回响应)。**

	在 HTTP 通信时，由于服务器不确认请求发起方的身份，所以任何设备都可以发起请求，服务器会对每一个接收到的请求进行响应（当然，服务器可以限制 IP 地址和端口号）。由于服务器会响应所有接收到的请求，所以有人就利用这一点，给服务器发起海量的无意义的请求，造成服务器无法响应正式的请求，这就是 Dos 攻击（Denial Of Service，拒绝服务攻击）。由于客户端也不会验证服务器是否真实，所以遇到来自假的服务器的响应时，客户端也不知道，只能交由人来判断。钓鱼网站就是利用了这一点。
	
3. **无法证明报文的完整性，可能会遭篡改(没有办法确认发出的请求/响应和接收到的请求/响应前后一致)。**

	HTTP 协议是无法证明通信报文的完整性的。因此请求或响应在途中随时可能被篡改而不自知，也就是说，没有任何办法确认，发出的请求/响应和接收到的请求/响应是前后相同的。比如浏览器从某个网站上下载一个文件，它是无法确定下载的文件和服务器上有些话的文件是同一个文件的。文件在传输过程中被掉包了也是不知道的。这种请求或响应在传输途中，被拦截、篡改的攻击就是中间人攻击。比如某运营商或者某些DNS提供商会偷偷地在你的网页中插入广告脚本，就是典型的例子。


为了解决这些问题，HTTPS协议应运而生

### 2.什么是HTTPS协议？

>超文本传输安全协议（英语：Hypertext Transfer Protocol Secure，缩写：HTTPS，常称为HTTP over TLS，HTTP over SSL或HTTP Secure）是一种通过计算机网络进行安全通信的传输协议。HTTPS经由HTTP进行通信，但利用SSL/TLS来加密数据包。HTTPS开发的主要目的，是提供对网站服务器的身份认证，保护交换数据的隐私与完整性。这个协议由网景公司（Netscape）在1994年首次提出，随后扩展到互联网上。

形象地说来，HTTPS就是HTTP + S，概括说来就是**HTTP+加密+认证+完整性保护 = HTTPS**。

HTTPS并非是应用层的一种新协议。只是HTTP通信接口部分用SLL(Secure Socket Layer)和TLS (Transport Layer Security) 协议替代而已。

通常, HTTP直接和TCP通信, 当使用SSL时, 演变成了先和SSL通信, 再由SSL和TCP通信了, 简而言之, 所谓HTTPS, 其实就是身披SSL协议的这层外壳的HTTP。

在采用SSL后, HTTP就拥有了HTTPS的加密, 证书和完整性的保护这些功能。

SSL是独立于HTTP的协议, 所有不光是HTTP协议, 其他运行在应用层的SMTP(邮件协议)和Telnet等协议均可配合SSL协议使用。可以说SSL是当今世界上应用最广泛的网络安全技术。

### 3.HTTPS协议是如何加密的？

上文中有提到，HTTPS协议通俗来说就是在HTTP协议的基础上增加一个SSL，在了解HTTPS协议如何加密之前就需要先了解SSL协议如何加密。

#### 3.1 SSL是如何加密的

##### 对称加密和非对称加密
	
* 共享密钥加密(common key crypto system)，即**对称加密**

	也被叫做对密钥加密.以共享密钥方式加密时必须将密钥也发给对方.在互联网上转发密钥时,如果通信被监听那么密钥就会落入攻击者之手,另外还得设法安全的保管接收到的密钥.

* 公开密钥加密(public-key cryptography)，即**非对称加密**
	
	加密算法是公开的，而密钥是保密的。加密和解密都会用到密钥。但反过来说只要持有密钥就能解密。
	
	公开密钥加密使用一对非对称的密钥。一把私钥一把公钥。私钥不能让任何人知道，公钥任何人都能获得。也就是发送密文一方使用对方的公钥进行加密处理，对方收到被加密的信息后，再使用自己的的私钥进行解密。利用这种方法不需要发送用来解密的私钥，也不必担心密钥被盗走。
	
##### SSL采用的就是非对称加密

SSL/TLS协议的基本思路是采用公钥加密法，也就是说，客户端先向服务器端索要公钥，然后用公钥加密信息，服务器收到密文后，用自己的私钥解密。

但是这样会存在一个问题：如何保证公钥不被篡改？

解决办法就是：将公钥放在数字证书中。只要证书是可信的，公钥就是可信的。
	
除了需要考虑公钥的安全问题，还需要考虑的一个问题是，公钥加密计算量太大，对机器性能和计算时间都会产生很大的影响。

那么该如何解决这个问题呢？
	
#### 3.2 HTTPS协议采用了混合加密机制

HTTPS在传输数据之前需要客户端（浏览器）与服务端（网站）之间进行一次握手，在握手过程中将确立双方加密传输数据的密码信息。TLS/SSL中使用了非对称加密，对称加密以及HASH算法。

握手过程中如果有任何错误，都会使加密连接断开，从而阻止了隐私信息的传输。

### 4.HTTPS的缺陷

虽然说，通过混合加密机制，能够很大程度上解决解密耗时长的问题，但比起原来HTTP的简单传输，通信时间耗费方面还是个严重的问题，除了通信时间问题，由于HTTPS还需要做服务器、客户端双方加密及解密处理，因此会消耗CPU和内存等硬件资源。所以在采用了HTTPS协议后，会消耗更多的资源。

同时，为了达成HTTPS传输，还需要购买证书，这同样也是一笔开销。

所以，普通的非敏感信息使用HTTP通信，敏感信息使用HTTPS通信，也不失为一种解决办法。

## 参考文章
* [超文本传输安全协议](https://zh.wikipedia.org/wiki/超文本传输安全协议)
* [Http和Https的区别](http://www.jianshu.com/p/37654eb66b58)
* [详解HTTPS原理](http://www.jianshu.com/p/55e402bcbc18)
* [HTTP和HTTPS的区别- petercao - 博客园](http://www.cnblogs.com/bluestorm/p/5763533.html)
* [HTTPS 理论详解与实践- 某熊的全栈之路- SegmentFault](https://segmentfault.com/a/1190000004985253)
* [SSL/TLS协议运行机制的概述- 阮一峰的网络日志 - 阮一峰的个人网站](http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html)
* [HTTPS那些事（一）HTTPS原理\| 互联网搭车客小组\| 果壳网科技有意思](http://www.guokr.com/post/114121/)